var W=Object.defineProperty;var J=(s,t,e)=>t in s?W(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(J(s,typeof t!="symbol"?t+"":t,e),e);import{h as X}from"./vendor.ac3731c2.js";const j=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}};j();const y=2*Math.PI;function B(s){return Math.sqrt(s.x*s.x+s.y*s.y)}const g=document.getElementById("game-canvas"),r=g.getContext("2d");function _(){r.imageSmoothingEnabled=!1}const E=window.devicePixelRatio?window.devicePixelRatio:1;r.scale(E,E);r.save();r.width=g.clientWidth;r.height=g.clientHeight;let T=0;function Y(){const s=performance.now();if(s-T<10)return;T=s,console.log("resize");const t=window.innerWidth,e=window.innerHeight,i=r.width/r.height,n=t/e;let a=1;n>=i?a=e/r.height:a=t/r.width,a>1&&(a=Math.floor(a)),g.width=r.width*a*E,g.height=r.height*a*E,g.style.width=`${r.width*a}px`,g.style.height=`${r.height*a}px`,r.restore(),r.save(),r.scale(a*E,a*E),_()}window.addEventListener("resize",Y);r.setGameSize=function(s,t){this.width=s,this.height=t,Y()};r.clear=function(s){this.fillStyle=s,this.clearRect(0,0,r.width,r.height),this.fillRect(0,0,r.width,r.height)};r.drawLine=function(s,t,e,i){this.beginPath(),this.moveTo(s,t),this.lineTo(e,i),this.closePath(),this.stroke()};r.drawCircle=function(s,t,e){this.beginPath(),this.arc(s,t,e,0,y),this.closePath(),this.stroke()};r.fillCircle=function(s,t,e){this.beginPath(),this.arc(s,t,e,0,y),this.closePath(),this.fill()};r.tintTexture=function(s,t){const e=document.createElement("canvas");e.width=s.width,e.height=s.height;const i=e.getContext("2d");i.drawImage(s,0,0),i.globalCompositeOperation="source-in",i.fillStyle=t,i.fillRect(0,0,e.width,e.height);const n=e.toDataURL(),a=new Image(e.width,e.height);return a.src=n,i.globalCompositeOperation="source-in",a};const P={Space:"space",Enter:"enter",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d",KeyQ:"q",KeyE:"e",Digit1:"one",Digit2:"two",Digit3:"three",Digit4:"four",Digit5:"five"};class G{constructor(){o(this,"mouseX",0);o(this,"mouseY",0);o(this,"keys",{});o(this,"mouseButton",[!1,!1]);for(const t in P)this.keys[P[t]]=[!1,!1];window.addEventListener("keydown",t=>{t.preventDefault();const e=P[t.code];e&&(this.keys[e][0]=!0)}),window.addEventListener("keyup",t=>{t.preventDefault();const e=P[t.code];e&&(this.keys[e][0]=!1)}),r.canvas.addEventListener("mousemove",t=>{t.preventDefault();const e=r.width/r.canvas.clientWidth,i=r.canvas.getClientRects()[0];return this.mouseX=(t.clientX-i.x)*e,this.mouseY=(t.clientY-i.y)*e,!1}),r.canvas.addEventListener("mousedown",t=>(t.preventDefault(),t.button===0&&(this.mouseButton[0]=!0),!1)),r.canvas.addEventListener("mouseup",t=>(t.preventDefault(),t.button===0&&(this.mouseButton[0]=!1),!1))}newFrame(){for(const t in this.keys)this.keys[t][1]=this.keys[t][0];this.mouseButton[1]=this.mouseButton[0]}mouseIsPressed(){return!!this.mouseButton[0]}mouseIsJustPressed(){return!!(this.mouseButton[0]&&!this.mouseButton[1])}mouseIsJustReleased(){return!!(!this.mouseButton[0]&&this.mouseButton[1])}keyIsPressed(...t){if(t.length>0){for(let e=0;e<t.length;++e)if(this.keys[t[e]][0])return!0}else for(const e in this.keys)if(this.keys[e][0])return!0;return!1}keyIsJustPressed(...t){if(t.length>0){for(let e=0;e<t.length;++e)if(this.keys[t[e]][0]&&!this.keys[t[e]][1])return!0}else for(const e in this.keys)if(this.keys[e][0]&&!this.keys[e][1])return!0;return!1}keyIsJustReleased(...t){if(t.length>0){for(let e=0;e<t.length;++e)if(!this.keys[t[e]][0]&&this.keys[t[e]][1])return!0}else for(const e in this.keys)if(!this.keys[e][0]&&this.keys[e][1])return!0;return!1}}const p=new G;class q{constructor(){o(this,"time",0);o(this,"slowdown",1);o(this,"dt",1/60)}deltaTime(){return this.dt*this.slowdown}}const w=new q;class K{constructor(t,e){o(this,"loopTimerID",0);o(this,"lastFrameTime");o(this,"states",[]);o(this,"shouldCallResume",!1);o(this,"resumeArgs");r.setGameSize(t,e),this.lastFrameTime=performance.now()}run(t){this.states.push(t),this.states[this.states.length-1].start(),this.update()}quit(){var t;do(t=this.states.pop())==null||t.end();while(this.states.length>0);window.cancelAnimationFrame(this.loopTimerID),document.removeChild(r.canvas)}pushState(t,e){this.states[this.states.length-1].pause(),this.states.push(t),this.shouldCallResume=!1,t.start(e)}popState(t){var e;this.states.length>1?((e=this.states.pop())==null||e.end(),this.shouldCallResume=!0,this.resumeArgs=t):console.error("Trying to pop the last game state of the state stack!")}peekState(){return this.states[this.states.length-1]}update(){this.loopTimerID=window.requestAnimationFrame(()=>this.update());const t=performance.now(),e=(t-this.lastFrameTime)/1e3;w.dt=e,w.time+=e,this.shouldCallResume&&(this.shouldCallResume=!1,this.states[this.states.length-1].resume(this.resumeArgs)),this.states[this.states.length-1].update(),r.clear("black");for(const i of this.states)i.draw();this.lastFrameTime=t,p.newFrame()}}class M{start(t){}end(){}resume(t){}pause(){}update(){}draw(){}}class V{constructor(){o(this,"clips");this.clips={},this.load("menu","./res/audio/music/menu.mp3",!0),this.load("pee","./res/audio/sfx/pee.mp3",!1),this.load("battle","./res/audio/music/battle.mp3",!0)}load(t,e,i,n=1){const a=new X.Howl({src:e,loop:i,volume:n});this.clips[t]=a}play(t,e=1){this.clips[t].volume(e),this.clips[t].play()}fadeOut(t,e){let i=this.clips[t];i.fade(i.volume(),0,e),i.on("fade",()=>{i.stop()})}}const x=new V;var h;(function(s){s[s.INVALID_TYPE=0]="INVALID_TYPE",s[s.PEAPROJECTILE=1]="PEAPROJECTILE",s[s.ENEMY=2]="ENEMY",s[s.SHADOW=3]="SHADOW",s[s.HURTABLE=4]="HURTABLE",s[s.TILEMAP=5]="TILEMAP",s[s.ANIMATOR=6]="ANIMATOR",s[s.COLLIDER=7]="COLLIDER",s[s.MOVER=8]="MOVER",s[s.TEXT=9]="TEXT",s[s.PLAYER=10]="PLAYER",s[s.UPGRADE=11]="UPGRADE",s[s.STATS=12]="STATS",s[s.CHEF=13]="CHEF",s[s.NUM_TYPES=14]="NUM_TYPES"})(h||(h={}));class u{constructor(t,e){o(this,"type",0);o(this,"active",!0);o(this,"entity");this.entity=t,this.type=e}awake(){}update(){}render(){}destroy(){}get world(){return this.entity.world}}const b={},S={};function z(s,t){return new Promise((e,i)=>{const n=new Image;n.onload=()=>{b[s]=n,e(n)},n.onerror=()=>{i(t)},n.src=t})}function $(s){return new Promise((t,e)=>{if(s.length===0){t();return}const i=[];s.forEach(n=>{i.push(z(n[0],n[1]))}),Promise.all(i).then(()=>{t()}).catch(n=>{e(n)})})}function Q(s){return new Promise((t,e)=>{fetch(s,{method:"GET"}).then(i=>i.json()).then(i=>{t(i)}).catch(i=>{console.error(`Failed to load "${s}": ${i}`),e()})})}function C(s){return new Promise((t,e)=>{Q(s).then(i=>{for(const n in i)S[n]=i[n];t(S)}).catch(()=>{e()})})}class I extends u{constructor(t,e,i){super(i,h.ANIMATOR);o(this,"xOffset",0);o(this,"yOffset",0);o(this,"img");o(this,"sprite");o(this,"frameIndex",0);o(this,"frameTime",0);o(this,"current");o(this,"currentAnim");o(this,"columns");this.sprite=t,this.img=b[t.image],console.assert(this.img!==void 0,"Failed to load image for animation"),this.columns=this.sprite.width/this.sprite.frameWidth|0,this.current=e,this.currentAnim=this.sprite.anims[this.current]}play(t){t!==this.current&&(this.current=t,this.currentAnim=this.sprite.anims[t],this.frameTime=0,this.frameIndex=0)}awake(){this.frameIndex=0,this.frameTime=0}update(){const t=w.deltaTime()*1e3;for(this.frameTime+=t;this.frameTime>=this.currentAnim.framedurations[this.frameIndex];)this.frameTime-=this.currentAnim.framedurations[this.frameIndex],this.frameIndex+=1,this.frameIndex>=this.currentAnim.framedurations.length&&(this.frameIndex=0)}render(){if(this.entity.visible){const t=this.currentAnim.start+this.frameIndex,e=t%this.columns*this.sprite.frameWidth,i=(t/this.columns|0)*this.sprite.frameHeight;r.drawImage(this.img,e,i,this.sprite.frameWidth,this.sprite.frameHeight,this.entity.position.x+this.xOffset,this.entity.position.y+this.yOffset,this.sprite.frameWidth,this.sprite.frameHeight)}}}class A extends u{constructor(t,e,i){super(i,h.COLLIDER);o(this,"mask");o(this,"radius");o(this,"debugDraw",!1);this.radius=t,this.mask=e}render(){this.debugDraw&&(r.strokeStyle="red",r.drawCircle(this.entity.position.x,this.entity.position.y,this.radius))}collidesAt(t,e,i){return this.firstCollisionAt(t,e,i)!==null}firstCollisionAt(t,e,i){for(const n of this.world.all(h.COLLIDER))if((n.mask&t)!=0&&this.collidesWithAt(n,e,i))return n;return null}allCollisionsAt(t,e,i){const n=[];for(const a of this.world.all(h.COLLIDER))(a.mask&t)!=0&&this.collidesWithAt(a,e,i)&&n.push(a);return n}collidesWithAt(t,e,i){const n=this.entity.position.x+e-t.entity.position.x,a=this.entity.position.y+i-t.entity.position.y,l=n*n+a*a,f=this.radius+t.radius;return l<=f*f}}class D extends u{constructor(t){super(t,h.ENEMY)}}class L extends u{constructor(t,e,i){super(i,h.HURTABLE);o(this,"hurtBy");o(this,"collider");o(this,"onHurt");this.hurtBy=e,this.onHurt=t,this.collider=this.entity.first(h.COLLIDER)}update(){this.collider.collidesAt(this.hurtBy,0,0)&&(this.onHurt?this.onHurt():this.world.destroyEntity(this.entity))}}var d;(function(s){s[s.NONE=0]="NONE",s[s.SOLID=1]="SOLID",s[s.PLAYER=4]="PLAYER",s[s.ENEMY=8]="ENEMY",s[s.PLAYER_PROJECTILE=16]="PLAYER_PROJECTILE",s[s.ENEMY_PROJECTILE=32]="ENEMY_PROJECTILE",s[s.UPGRADE=64]="UPGRADE"})(d||(d={}));class Z extends u{constructor(t,e){super(e,h.MOVER);o(this,"inputx",0);o(this,"inputy",0);o(this,"speed",64);o(this,"xError",0);o(this,"yError",0);o(this,"speedModifier",1);o(this,"collider");o(this,"onCollisionX");o(this,"onCollisionY");this.speed=t}update(){const t=w.deltaTime();let e=this.inputx,i=this.inputy;if(Math.abs(e)+Math.abs(i)>1){const n=Math.sqrt(e*e+i*i);e/=n,i/=n}this.moveX(e*this.speed*this.speedModifier*t),this.moveY(i*this.speed*this.speedModifier*t)}moveX(t){if(this.collider){if(this.xError+=t,t=Math.round(this.xError),Math.abs(t)>0){const e=Math.sign(t);for(;t!==0;){if(this.collider.collidesAt(d.SOLID,e,0)){this.onCollisionX?this.onCollisionX(this):this.stopX();break}this.entity.position.x+=e,t-=e,this.xError-=e}}}else this.entity.position.x+=t}moveY(t){if(this.collider){if(this.yError+=t,t=Math.round(this.yError),Math.abs(t)>0){const e=Math.sign(t);for(;t!==0;){if(this.collider.collidesAt(d.SOLID,0,e)){this.onCollisionY?this.onCollisionY(this):this.stopY();break}this.entity.position.y+=e,t-=e,this.xError-=e}}}else this.entity.position.y+=t}setSpeedModifier(t){this.speedModifier=t}stopX(){this.xError=0}stopY(){this.xError=0}}class tt extends u{constructor(t,e){super(e,h.PEAPROJECTILE);o(this,"dx",0);o(this,"dy",0);o(this,"color");this.color=t,x.play("pee")}update(){const t=w.deltaTime();this.entity.position.x+=this.dx*t,this.entity.position.y+=this.dy*t,B(this.entity.position)>256&&this.world.destroyEntity(this.entity)}render(){r.fillStyle=this.color,r.fillCircle(this.entity.position.x,this.entity.position.y,2)}}class et extends u{constructor(t){super(t,h.PLAYER);o(this,"mover");o(this,"animator");o(this,"chef");o(this,"weaponCooldown",0);o(this,"firedWeapon",!1);this.mover=this.entity.first(h.MOVER),this.animator=this.entity.first(h.ANIMATOR),this.chef=this.entity.first(h.CHEF)}update(){if(this.chef.dying)this.mover.inputx=this.mover.inputy=0;else{const t=this.world.screenToWorld(p.mouseX,p.mouseY),e=t[0]-this.entity.position.x,i=t[1]-this.entity.position.y;this.entity.rotation=Math.atan2(i,e)+y/4,this.mover.inputx=this.mover.inputy=0,p.keyIsPressed("up","w")&&(this.mover.inputy-=1),p.keyIsPressed("down","s")&&(this.mover.inputy+=1),p.keyIsPressed("left","a")&&(this.mover.inputx-=1),p.keyIsPressed("right","d")&&(this.mover.inputx+=1),this.firedWeapon=!1,this.weaponCooldown<=0?p.mouseIsJustPressed()&&(this.chef.fire(),this.firedWeapon=!0):this.weaponCooldown-=w.deltaTime(),Math.abs(this.mover.inputx)+Math.abs(this.mover.inputy)>0?this.chef.animationState="move weapon1":this.chef.animationState="stand weapon1"}}}class it extends u{constructor(t,e){super(e,h.UPGRADE);o(this,"collider");o(this,"upgradeType");this.collider=this.entity.first(h.COLLIDER),this.upgradeType=t}update(){this.collider.collidesAt(d.PLAYER,0,0)&&(this.world.first(h.PLAYER).chef.takeUpgrade(this.upgradeType),this.world.destroyEntity(this.entity))}}class st extends u{constructor(t){super(t,h.SHADOW);o(this,"startX");o(this,"startY");o(this,"chef");this.startX=this.entity.position.x,this.startY=this.entity.position.y,this.chef=this.entity.first(h.CHEF)}}class k{constructor(){o(this,"shield",0);o(this,"speedModifier",1);o(this,"projectileSpeedModifier",1);o(this,"damageModifer",1);o(this,"slowOnHit",0);o(this,"stunChance",0);o(this,"invulnerabilityTime",0);o(this,"weaponSpreadModifier",1);o(this,"weaponCooldownModifier",1);o(this,"explosionDelay",0);o(this,"doubleShotChance",0);o(this,"explosionRangeModifier",1)}}class O extends u{constructor(t){super(t,h.STATS);o(this,"stats");this.stats=new k}apply(t){this.stats.shield+=t.shield,this.stats.speedModifier*=t.speedModifier,this.stats.projectileSpeedModifier*=t.projectileSpeedModifier,this.stats.damageModifer*=t.damageModifer,this.stats.slowOnHit+=t.slowOnHit,this.stats.stunChance+=t.stunChance,this.stats.invulnerabilityTime+=t.invulnerabilityTime,this.stats.weaponSpreadModifier*=t.weaponSpreadModifier,this.stats.weaponCooldownModifier*=t.weaponCooldownModifier,this.stats.explosionDelay+=t.explosionDelay,this.stats.doubleShotChance+=t.doubleShotChance,this.stats.explosionRangeModifier*=t.explosionRangeModifier,this.onApply()}onApply(){var t;(t=this.entity.first(h.MOVER))==null||t.setSpeedModifier(this.stats.speedModifier)}render(){this.stats.shield>0&&(r.strokeStyle="blue",r.drawCircle(this.entity.position.x,this.entity.position.y,8))}}class ot{constructor(t){o(this,"world");o(this,"cooldown",.1);this.world=t}fire(t,e,i,n){t+=Math.cos(i-y/4)*8,e+=Math.sin(i-y/4)*8,rt(t,e,i,128,n,this.world)}}class N extends u{constructor(t,e){super(e,h.CHEF);o(this,"animator");o(this,"weapon");o(this,"dying",!1);o(this,"animationState");o(this,"projectileMask");o(this,"upgradeType");this.projectileMask=t,this.animator=this.entity.first(h.ANIMATOR),this.weapon=new ot(this.world),this.animationState="stand weapon1"}fire(){this.weapon.fire(this.entity.position.x,this.entity.position.y,this.entity.rotation,this.projectileMask)}takeUpgrade(t){this.upgradeType=t,this.entity.first(h.STATS).apply(t.stats)}update(){this.dying?(this.animator.play("death"),this.animator.frameIndex===2&&this.animator.frameTime>=50&&this.world.destroyEntity(this.entity)):this.animator.play(this.animationState)}}function nt(s,t,e){const i=e.addEntity(s,t);i.add(new A(6,d.PLAYER,i)),i.add(new Z(64,i));const n=i.add(new O(i)),a=i.add(new I(S.maincharacter,"stand weapon1",i));a.xOffset=-16,a.yOffset=-21;const l=()=>{n.stats.shield>0?(console.log("Shield: "+n.stats.shield),n.stats.shield--):(console.log("Dying"),f.chef.dying=!0)};i.add(new L(l,d.ENEMY|d.ENEMY_PROJECTILE,i)),i.add(new N(d.PLAYER_PROJECTILE,i));const f=i.add(new et(i));return i}function rt(s,t,e,i,n,a){const l=a.addEntity(s,t),f=n===d.PLAYER_PROJECTILE?"lime":"#bc90da",R=l.add(new tt(f,l));return e-=y/4,R.dx=Math.cos(e)*i,R.dy=Math.sin(e)*i,l.add(new A(2,n,l)),n===d.PLAYER_PROJECTILE?d.ENEMY|d.PLAYER:d.PLAYER,l.add(new L(null,d.PLAYER,l)),l}function at(s,t,e){const i=e.addEntity(s,t);i.add(new A(8,d.ENEMY,i));const n=i.add(new I(S.slime,"move",i));return n.xOffset=-8,n.yOffset=-8,i.add(new L(null,d.PLAYER_PROJECTILE,i)),i.add(new D(i)),i}function ht(s,t,e,i){const n=i.addEntity(s,t);n.add(new O(n));const a=n.add(new I(S[e.name],e.animation,n));return n.add(new A(8,d.UPGRADE,n)),n.add(new it(e,n)),a.xOffset=-8,a.yOffset=-8,n}function lt(s,t,e){const i=e.addEntity(s,t);i.rotation=y/2,i.add(new A(6,d.ENEMY,i));const n=i.add(new O(i)),a=i.add(new I(S.maincharactershadow,"stand weapon1",i));a.xOffset=-16,a.yOffset=-21;const l=()=>{n.stats.shield>0?n.stats.shield--:i.first(h.CHEF).dying=!0};return i.add(new L(l,d.PLAYER_PROJECTILE,i)),i.add(new D(i)),i.add(new N(d.ENEMY_PROJECTILE,i)),i.add(new st(i)),i}class dt{constructor(t,e,i,n,a,l){o(this,"x");o(this,"y");o(this,"rotation");o(this,"animationState");o(this,"upgrade");o(this,"shoot",!1);this.x=t,this.y=e,this.rotation=i,this.animationState=n,this.upgrade=a,this.shoot=l}}class ct{constructor(){o(this,"recordings",[]);o(this,"currentIndex",0);o(this,"backwards",!1)}add(t){this.recordings.length<3600&&this.recordings.push(t)}get(t){return this.recordings[t]}getNext(){const t=this.recordings[this.currentIndex];return this.backwards?(this.currentIndex--,this.currentIndex==0&&(this.backwards=!1)):(this.currentIndex++,this.currentIndex==this.recordings.length-1&&(this.backwards=!0)),t}}class ut{constructor(t){o(this,"active",!0);o(this,"world");o(this,"position",{x:0,y:0});o(this,"rotation",0);o(this,"visible",!0);o(this,"components",[]);this.world=t}first(t){for(const e of this.components)if(e.type===t)return e;return null}add(t){return this.components.push(t),this.world.add(t),t}}class ft{constructor(){o(this,"entities",new Array);o(this,"components");o(this,"cameraX",0);o(this,"cameraY",0);this.components=[];for(let t=1;t<h.NUM_TYPES;++t)this.components.push([])}update(){for(const t of this.components)for(const e of t)e.active&&e.entity.active&&e.update()}render(){r.save(),r.translate(r.width/2-this.cameraX,r.height/2-this.cameraY),r.strokeStyle="white",r.drawCircle(0,0,64);for(const t of this.components)for(const e of t)e.active&&e.entity.active&&(r.save(),e.entity.rotation!==0&&(r.translate(e.entity.position.x,e.entity.position.y),r.rotate(e.entity.rotation),r.translate(-e.entity.position.x,-e.entity.position.y)),e.render(),r.restore());r.restore()}screenToWorld(t,e){return[t-r.width/2+this.cameraX,e-r.height/2+this.cameraY]}worldToScreen(t,e){return[t+r.width/2-this.cameraX,e+r.height/2-this.cameraY]}addEntity(t,e){const i=new ut(this);return i.position={x:t,y:e},this.entities.push(i),i}destroyEntity(t){t.active=!1;for(const e of t.components)this.destroy(e);for(let e=0;e<this.entities.length;++e)if(this.entities[e]===t){this.entities.splice(e,1);break}}first(t){return this.components[t].length>0?this.components[t-1][0]:null}all(t){return this.components[t-1]}add(t){return this.components[t.type-1].push(t),t.awake(),t}destroy(t){const e=this.components[t.type-1];for(let i=0;i<e.length;++i)if(e[i]===t){e.splice(i,1);break}t.destroy()}}class pt extends M{constructor(t,e){super();o(this,"duration");o(this,"t",0);o(this,"onFadeComplete");this.duration=t,this.onFadeComplete=e}update(){this.t+=w.deltaTime(),this.t>=this.duration&&(m.popState(),this.onFadeComplete&&this.onFadeComplete())}draw(){r.fillStyle=`rgba(0, 0, 0, ${this.t/this.duration}`,r.fillRect(0,0,r.width,r.height)}}class mt extends M{constructor(t){super();o(this,"duration");o(this,"t",0);this.duration=t}update(){this.t+=w.deltaTime(),this.t>=this.duration&&m.popState()}draw(){r.fillStyle=`rgba(0, 0, 0, ${1-this.t/this.duration}`,r.fillRect(0,0,r.width,r.height)}}class H{constructor(t,e){o(this,"name","crate");o(this,"animation","stand");o(this,"stats");this.stats=this.setStats(t,e)}setStats(t,e){let i=new k;switch(t){case c.shield:i.shield=e;case c.speed:i.speedModifier=e;case c.projectileSpeed:i.projectileSpeedModifier=e;case c.damage:i.damageModifer=e;case c.slow:i.slowOnHit=e;case c.stun:i.stunChance=e;case c.invulnerability:i.invulnerabilityTime=e;case c.weaponSpread:i.weaponSpreadModifier=e;case c.weaponCooldown:i.weaponCooldownModifier=e;case c.explosionDelay:i.explosionDelay=e;case c.doubleShot:i.doubleShotChance=e;case c.explosionRange:i.explosionRangeModifier=e}return i}}var c;(function(s){s[s.shield=0]="shield",s[s.speed=1]="speed",s[s.projectileSpeed=2]="projectileSpeed",s[s.damage=3]="damage",s[s.slow=4]="slow",s[s.stun=5]="stun",s[s.invulnerability=6]="invulnerability",s[s.weaponSpread=7]="weaponSpread",s[s.weaponCooldown=8]="weaponCooldown",s[s.explosionDelay=9]="explosionDelay",s[s.doubleShot=10]="doubleShot",s[s.explosionRange=11]="explosionRange"})(c||(c={}));class yt{constructor(){o(this,"upgradesTypes",[]);this.upgradesTypes.push(new H(c.speed,1.2)),this.upgradesTypes.push(new H(c.shield,1))}getRandomUpgrade(){const t=Math.floor(Math.random()*this.upgradesTypes.length);return this.upgradesTypes[t]}}class v extends M{constructor(t,e){super();o(this,"world");o(this,"player");o(this,"currentLevel",0);o(this,"recordings",[]);o(this,"shadows",[]);o(this,"currentRecording");o(this,"upgradeArray");if(this.world=new ft,this.player=nt(0,0,this.world).first(h.PLAYER),this.currentLevel=t,this.recordings=e,this.currentRecording=new ct,this.upgradeArray=new yt,t===0)at(0,-32,this.world);else{let i=0;for(let a=0;a<e.length;++a)i+=e.length-a,this.shadows.push([]);let n=32*e.length;for(let a=0;a<e.length;++a){const l=e.length-a;let f=0;for(let R=0;R<l;++R){const U=Math.cos(f)*n,F=Math.sin(f)*n;this.shadows[a].push(lt(U,F,this.world).first(h.SHADOW)),f+=y/l}n-=32}}ht(0,32,this.upgradeArray.getRandomUpgrade(),this.world),console.log(t)}update(){if(!this.player.entity.active){m.popState();return}for(let t=0;t<this.recordings.length;++t){const e=this.recordings[t].getNext();for(const i of this.shadows[t])i.entity.active&&(i.entity.position.x=i.startX+e.x,i.entity.position.y=i.startY+e.y,i.chef.animationState=e.animationState,i.entity.rotation=e.rotation,e.upgrade&&i.chef.takeUpgrade(e.upgrade),e.shoot&&i.chef.fire())}this.world.update(),this.world.cameraX=this.player.entity.position.x,this.world.cameraY=this.player.entity.position.y,this.currentRecording.add(new dt(this.player.entity.position.x,this.player.entity.position.y,this.player.entity.rotation,this.player.animator.current,this.player.chef.upgradeType?this.player.chef.upgradeType:null,this.player.firedWeapon)),this.world.all(h.ENEMY).length===0&&this.onNewLevel()}draw(){r.clear("black"),this.world.render()}onNewLevel(){this.recordings.push(this.currentRecording),m.pushState(new pt(1,()=>{m.popState(),m.pushState(new v(++this.currentLevel,this.recordings)),m.pushState(new mt(1))}))}}class wt extends M{constructor(){super();x.play("menu")}update(){p.mouseIsJustPressed()&&(m.pushState(new v(0,[])),x.fadeOut("menu",500),x.play("battle",.7))}draw(){r.fillStyle="white",r.fillText("Click to start",r.width/2,r.height/2)}resume(t){x.fadeOut("battle",500),x.play("menu")}}const m=new K(200,600/4),gt=[$([["crate","./res/crate.png"],["cthulhupotato","./res/cthulhupotato.png"],["maincharacter","./res/maincharacter.png"],["maincharactershadow","./res/maincharactershadow.png"],["pickups","./res/pickups.png"],["slime","./res/slime.png"]]),C("./res/sprites.json"),C("./res/sprites_shadow.json")];Promise.all(gt).then(s=>{m.run(new wt)});
